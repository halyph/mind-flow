# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

---

# mind-flow

Personal technical blog and knowledge base built with MkDocs Material theme, deployed to GitHub Pages.

- **Site**: https://halyph.github.io/
- **Repository**: halyph/mind-flow

## Development Commands

### Initial Setup
```bash
make install              # Creates .venv and installs dependencies from requirements.txt
source .venv/bin/activate # Activate venv manually after install
```

### Development
```bash
mkdocs serve              # Run local dev server at http://127.0.0.1:8000
make readme               # Regenerate README.md, docs/blog/index.md, and docs/blog/tags.md
make tags                 # Regenerate only docs/blog/tags.md
```

### Build
```bash
mkdocs build              # Build with mkdocs.yml (local config)
mkdocs build -f mkdocs.ci.yml  # Build with CI config (includes production plugins)
```

### Cleanup
```bash
make clean                # Remove .venv directory
```

## Architecture Overview

### Dual Content Structure

The site maintains two distinct content paradigms:

- **Blog**: Chronological posts in `docs/blog/YYYY/YYYY-MM-DD-title.md`
  - Reverse chronological ordering (newest first)
  - Auto-generated index via `scripts/generate-blog-index.py`

- **Wiki**: Topic-based knowledge pages in `docs/wiki/`
  - Organized by programming language (Lang-Go, Lang-Python, etc.)
  - Manual curation with index pages
  - Represents a "Digital Garden" approach

### Configuration Inheritance Pattern

The project uses two MkDocs configurations:

- **`mkdocs.yml`** - Base configuration for local development
- **`mkdocs.ci.yml`** - Extends base config via `INHERIT: mkdocs.yml`
  - Adds production-only plugins: minify, search, tags, rss
  - Used exclusively in CI/CD workflows

**Important**: When modifying MkDocs configuration, update `mkdocs.yml` first. The CI config will automatically inherit changes.

### Auto-Generated Index Files

Three scripts automatically generate index files by scanning blog posts:

**1. Blog Index (`scripts/generate-blog-index.py`)**
- Generates `README.md` and `docs/blog/index.md`
- Lists all blog posts by year (reverse chronological)
- Extracts titles from first line (assumes `# Title` format)
- Parses dates from filename pattern: `YYYY/YYYY-MM-DD-*`

**2. Tags Index (`scripts/generate-tags.py`)**
- Generates `docs/tags/index.md`
- Groups posts by tag (alphabetical tags, reverse chronological posts)
- Extracts tags from HTML comments: `<!-- tags: tag1, tag2 -->`
- Provides GitHub-native navigation for tagged posts
- Metadata controlled by `docs/tags/.meta.yml` (hides navigation)

**CRITICAL**: Do NOT manually edit these index files. They are completely regenerated by scripts.

**After adding/editing blog posts**: Always run `make readme` to regenerate all indexes.

### Tag System

Blog posts use HTML comments for tags, providing both GitHub and MkDocs functionality:

**Format in posts:**
```markdown
# Post Title
<!-- tags: scala, akka, time management -->

Post content...
```

**How it works:**
- HTML comments are invisible on GitHub (clean rendering)
- `scripts/generate-tags.py` generates `docs/tags/index.md` for GitHub navigation
- `scripts/hooks.py` extracts tags and injects as clickable links on each post
- Tags link to anchors on the tags page

**Tag conventions:**
- Lowercase only (e.g., `scala`, not `Scala`)
- Comma-separated: `tag1, tag2, tag3`
- Multi-word tags supported: `time management`, `software design`
- Place on line 2 (after title)

**Validation:**
- `scripts/validate-tags.py` checks all posts have valid tags
- Optional GitHub Action can enforce tags in CI

**Migration:**
- `scripts/migrate-tags.py` converts old blockquote format to HTML comments
- Run once for initial migration: `python3 scripts/migrate-tags.py`

### Navigation Control via .pages Files

Navigation is managed using the `mkdocs-awesome-pages-plugin` with `.pages` YAML files:

- `docs/.pages` - Top-level navigation order
- `docs/wiki/.pages` - Wiki section ordering
- `docs/blog/.pages` - Blog sorting configuration

Each `.pages` file controls navigation for its directory level.

## Deployment Workflow

### Two GitHub Actions Workflows

**1. ci.yaml (Production Deployment)**
- **Triggers**: Push to master, manual workflow_dispatch
- **Configuration**: `mkdocs.ci.yml` (with production plugins)
- **Deployment**: External repository `halyph/halyph.github.io` (master branch)
- **Git History**: Full history (`fetch-depth: 0`) for revision date tracking

**2. build-test.yaml (Validation Only)**
- **Triggers**: Pull requests, pushes to non-master branches, manual
- **Configuration**: `mkdocs.ci.yml` (same as production)
- **Deployment**: None - validation only
- **Git History**: Shallow clone (`fetch-depth: 1`) for speed
- **Artifacts**: Uploads built site with 5-day retention

**Pattern**: Master branch auto-deploys to production. All other branches validate builds without deploying.

## Content Conventions

### Blog Post Format
- **Location**: `docs/blog/YYYY/YYYY-MM-DD-short-title.md`
- **First line**: `# Title` (extracted by scripts/generate-blog-index.py)
- **Second line**: `<!-- tags: tag1, tag2, multi word tag -->` (lowercase, comma-separated)
- **Filename**: Date prefix must match directory year
- **Tags**: HTML comment format, invisible on GitHub, extracted by MkDocs hook

### Wiki Page Format
- **Location**: `docs/wiki/Lang-{Language}/topic.md` or `docs/wiki/howtos/topic.md`
- **Structure**: Can have nested subdirectories (e.g., Cookbook/)

## Critical File Paths

### Index Generation Scripts
- `scripts/generate-blog-index.py` - Blog index generator (README.md, docs/blog/index.md)
- `scripts/generate-tags.py` - Tags index generator (docs/tags/index.md)
- `scripts/migrate-tags.py` - One-time migration script (blockquote â†’ HTML comments)
- `scripts/validate-tags.py` - Tags validation script
- `scripts/hooks.py` - MkDocs hooks (date and tag extraction)

### Configuration
- `mkdocs.yml` - Base MkDocs configuration
- `mkdocs.ci.yml` - CI configuration (inherits base)
- `requirements.txt` - Python dependencies
- `Makefile` - Development commands

### CI/CD
- `.github/workflows/ci.yaml` - Production deployment
- `.github/workflows/build-test.yaml` - Build validation

## Testing & Validation

- **No unit tests**: This is a content-focused site. Validation occurs through successful MkDocs builds.
- **No linting**: No Python linting or formatting tools configured.
- **Build validation**: GitHub Actions `build-test.yaml` workflow validates all PRs and branches.
