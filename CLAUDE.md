# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

---

# mind-flow

Personal technical blog and knowledge base built with MkDocs Material theme, deployed to GitHub Pages.

- **Site**: https://halyph.github.io/
- **Repository**: halyph/mind-flow

## Development Commands

### Initial Setup
```bash
make install              # Creates .venv and installs dependencies from requirements.txt
source .venv/bin/activate # Activate venv manually after install
```

### Development
```bash
mkdocs serve              # Run local dev server at http://127.0.0.1:8000
make readme               # Regenerate README.md and docs/blog/index.md
```

### Build
```bash
mkdocs build              # Build with mkdocs.yml (local config)
mkdocs build -f mkdocs.ci.yml  # Build with CI config (includes production plugins)
```

### Cleanup
```bash
make clean                # Remove .venv directory
```

## Architecture Overview

### Dual Content Structure

The site maintains two distinct content paradigms:

- **Blog**: Chronological posts in `docs/blog/YYYY/YYYY-MM-DD-title.md`
  - 173 posts spanning 2009-2026
  - Reverse chronological ordering (newest first)
  - Auto-generated index via `readme-index.py`

- **Wiki**: Topic-based knowledge pages in `docs/wiki/`
  - 53 pages organized by programming language (Lang-Go, Lang-Python, etc.)
  - Manual curation with index pages
  - Represents a "Digital Garden" approach

### Configuration Inheritance Pattern

The project uses two MkDocs configurations:

- **`mkdocs.yml`** - Base configuration for local development
- **`mkdocs.ci.yml`** - Extends base config via `INHERIT: mkdocs.yml`
  - Adds production-only plugins: minify, search, tags, rss
  - Used exclusively in CI/CD workflows

**Important**: When modifying MkDocs configuration, update `mkdocs.yml` first. The CI config will automatically inherit changes.

### Auto-Generated Index Files

The script `readme-index.py` automatically generates two index files by scanning blog posts:

- **`README.md`** - Root project index (with full paths: `docs/blog/...`)
- **`docs/blog/index.md`** - Blog index (with relative paths)

**CRITICAL**: Do NOT manually edit these index files. They are completely regenerated by the script.

**How it works:**
1. Scans all `docs/blog/**/*.md` files (excluding `index.md`)
2. Extracts title from first line (assumes `# Title` format)
3. Parses date from filename pattern: `YYYY/YYYY-MM-DD-*`
4. Groups posts by year, sorts in reverse chronological order

**After adding blog posts**: Always run `python3 readme-index.py` to update indexes.

### Navigation Control via .pages Files

Navigation is managed using the `mkdocs-awesome-pages-plugin` with `.pages` YAML files:

- `docs/.pages` - Top-level navigation order
- `docs/wiki/.pages` - Wiki section ordering
- `docs/blog/.pages` - Blog sorting configuration

Each `.pages` file controls navigation for its directory level.

## Deployment Workflow

### Two GitHub Actions Workflows

**1. ci.yaml (Production Deployment)**
- **Triggers**: Push to master, manual workflow_dispatch
- **Configuration**: `mkdocs.ci.yml` (with production plugins)
- **Deployment**: External repository `halyph/halyph.github.io` (master branch)
- **Git History**: Full history (`fetch-depth: 0`) for revision date tracking

**2. build-test.yaml (Validation Only)**
- **Triggers**: Pull requests, pushes to non-master branches, manual
- **Configuration**: `mkdocs.ci.yml` (same as production)
- **Deployment**: None - validation only
- **Git History**: Shallow clone (`fetch-depth: 1`) for speed
- **Artifacts**: Uploads built site with 5-day retention

**Pattern**: Master branch auto-deploys to production. All other branches validate builds without deploying.

## Content Conventions

### Blog Post Format
- **Location**: `docs/blog/YYYY/YYYY-MM-DD-short-title.md`
- **First line**: `# Title` (extracted by readme-index.py)
- **Filename**: Date prefix must match directory year

### Wiki Page Format
- **Location**: `docs/wiki/Lang-{Language}/topic.md` or `docs/wiki/howtos/topic.md`
- **Structure**: Can have nested subdirectories (e.g., Cookbook/)

## Critical File Paths

- `readme-index.py` - Index generator script
- `mkdocs.yml` - Base MkDocs configuration
- `mkdocs.ci.yml` - CI configuration (inherits base)
- `requirements.txt` - Python dependencies
- `Makefile` - Development commands
- `.github/workflows/ci.yaml` - Production deployment
- `.github/workflows/build-test.yaml` - Build validation

## Testing & Validation

- **No unit tests**: This is a content-focused site. Validation occurs through successful MkDocs builds.
- **No linting**: No Python linting or formatting tools configured.
- **Build validation**: GitHub Actions `build-test.yaml` workflow validates all PRs and branches.
