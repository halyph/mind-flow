# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

---

# mind-flow

Personal technical blog and knowledge base built with MkDocs Material theme, deployed to GitHub Pages.

- **Site**: https://halyph.github.io/
- **Repository**: halyph/mind-flow

## Development Commands

### Initial Setup
```bash
make install              # Creates .venv and installs dependencies from requirements.txt
source .venv/bin/activate # Activate venv manually after install
```

### Development
```bash
mkdocs serve              # Run local dev server at http://127.0.0.1:8000
make readme               # Regenerate README.md, docs/blog/index.md, and docs/blog/tags.md
make tags                 # Regenerate only docs/blog/tags.md
```

### Build
```bash
mkdocs build              # Build with mkdocs.yml (local config)
mkdocs build -f mkdocs.ci.yml  # Build with CI config (includes production plugins)
```

### Cleanup
```bash
make clean                # Remove .venv directory
```

## Architecture Overview

### Dual Content Structure

- **Blog**: Chronological posts in `docs/blog/YYYY/YYYY-MM-DD-title.md`
  - Reverse chronological ordering
  - Auto-generated index

- **Wiki**: Topic-based knowledge pages in `docs/wiki/`
  - Organized by topic/language
  - Manual curation
  - Digital Garden approach

### Configuration Inheritance

Two MkDocs configurations:

- **`mkdocs.yml`** - Base configuration for local development
- **`mkdocs.ci.yml`** - Extends base via `INHERIT`, adds production plugins (minify, search, tags, rss)

**Important**: Modify `mkdocs.yml` first. CI config inherits changes automatically.

### Auto-Generated Index Files

Scripts automatically generate index files by scanning blog posts:

**Blog Index** (`scripts/generate-blog-index.py`)
- Generates `README.md` and `docs/blog/index.md`
- Lists posts by year in reverse chronological order
- Extracts titles from first heading and dates from filename

**Tags Index** (`scripts/generate-tags.py`)
- Generates `docs/tags/index.md` and `docs/tags/cloud.svg`
- Groups posts by tag (alphabetical tags, reverse chronological posts)
- Extracts tags from HTML comments
- Provides GitHub-native navigation
- Uses `scripts/tag_cloud.py` module to generate interactive SVG tag cloud

**Tag Cloud** (`scripts/tag_cloud.py`)
- Standalone module for generating SVG tag clouds
- Implements spiral placement algorithm with collision detection
- Font sizes proportional to tag post counts
- Clickable tags linking to anchor sections
- Can be imported and reused by other scripts

**CRITICAL**: Never manually edit index files. They are completely regenerated by scripts.

**After modifying blog posts**: Run `make readme` to regenerate all indexes.

### Tag System

Blog posts use HTML comments for tags (format: `<!-- tags: tag1, tag2 -->`):

**How it works:**
- HTML comments are invisible on GitHub
- `scripts/generate-tags.py` generates tag index for GitHub navigation
- `scripts/hooks.py` extracts tags and injects as clickable links in MkDocs
- Tags link to anchors on the tags index page

**Tag conventions:**
- Lowercase only
- Comma-separated
- Multi-word tags supported
- Placed on line 2 (after title)

**Available scripts:**
- `scripts/validate-tags.py` - Validates tag format in all posts
- `scripts/migrate-tags.py` - One-time migration tool (blockquote → HTML comments)

**Tag Cloud Visualization:**
- Interactive SVG tag cloud generated at `docs/tags/cloud.svg`
- Font sizes proportional to post counts (12-48px range)
- Spiral placement algorithm with collision detection
- Dynamic sizing to minimize white space
- All tags are clickable and link to their sections
- Embedded in tags index page using `<object>` tag
- Configuration in `scripts/tag_cloud.py` (max: 800×600px, auto-adjusts to content)
- Static fallback image for GitHub, interactive links in MkDocs

### Navigation Control

Navigation managed via `mkdocs-awesome-pages-plugin` using `.pages` YAML files:
- `docs/.pages` - Top-level navigation
- `docs/wiki/.pages` - Wiki section
- `docs/blog/.pages` - Blog sorting

Each file controls navigation for its directory level.

## Deployment Workflow

Two GitHub Actions workflows:

**ci.yaml** - Production deployment
- Triggers on master branch push
- Uses `mkdocs.ci.yml` configuration
- Deploys to external GitHub Pages repository
- Requires full git history for revision dates

**build-test.yaml** - Build validation
- Triggers on PRs and non-master branches
- Uses same configuration as production
- No deployment, validation only
- Uploads build artifacts

**Pattern**: Master deploys automatically, other branches validate only.

## Content Conventions

### Blog Post Format
- **Location**: `docs/blog/YYYY/YYYY-MM-DD-short-title.md`
- **Line 1**: H1 heading with title (extracted by index generator)
- **Line 2**: HTML comment with tags (lowercase, comma-separated)
- **Filename**: Date prefix must match directory year
- **Thumbnails** (optional): Markdown image with `alt="thumbnail"` for floating display

### Blog Post Thumbnails

Optional floating thumbnail images displayed on the right side of content.

**Usage:**
- Markdown syntax: `![thumbnail](path/to/image.ext)`
- Place image in post's subdirectory
- MkDocs hook transforms to floating right-aligned div
- Styled by `docs/assets/css/extra.css`

**Configuration:**
- Size: Adjust `--thumbnail-size` CSS variable
- Border radius: Modify `border-radius` property
- Toggle: Set `ENABLE_THUMBNAIL_TRANSFORM` flag in `scripts/hooks.py`

**Behavior:**
- GitHub: Normal markdown image
- MkDocs: Fixed-size square with rounded corners, floats right
- Images cropped to fill square via CSS

### Wiki Page Format
- **Location**: `docs/wiki/` with subdirectories by topic or language
- **Structure**: Supports nested subdirectories

## Critical File Paths

### Index Generation Scripts
- `scripts/generate-blog-index.py` - Blog index generator (README.md, docs/blog/index.md)
- `scripts/generate-tags.py` - Tags index generator (docs/tags/index.md, docs/tags/cloud.svg)
- `scripts/tag_cloud.py` - Tag cloud SVG generator module (imported by generate-tags.py)
- `scripts/migrate-tags.py` - One-time migration script (blockquote → HTML comments)
- `scripts/validate-tags.py` - Tags validation script
- `scripts/hooks.py` - MkDocs hooks (date extraction, tag processing, thumbnail transformation)

### Configuration
- `mkdocs.yml` - Base MkDocs configuration
- `mkdocs.ci.yml` - CI configuration (inherits base)
- `requirements.txt` - Python dependencies
- `Makefile` - Development commands
- `docs/assets/css/extra.css` - Custom CSS (includes thumbnail styling)

### CI/CD
- `.github/workflows/ci.yaml` - Production deployment
- `.github/workflows/build-test.yaml` - Build validation

## Testing & Validation

- **No unit tests**: This is a content-focused site. Validation occurs through successful MkDocs builds.
- **No linting**: No Python linting or formatting tools configured.
- **Build validation**: GitHub Actions `build-test.yaml` workflow validates all PRs and branches.
