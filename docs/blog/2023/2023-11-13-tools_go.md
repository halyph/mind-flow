# Manage Go CLI tools via Go modules and tools.go
> | golang |

## Problem definition

1. Every my Go project has at least two Go CLI tools: [mockery](https://github.com/vektra/mockery) and [golangci-lint](https://github.com/golangci/golangci-lint).
2. These CLI tools might have different version in different repository. I can't use the latest version for any of this tool because it is error prone (i.e. **mockery** generates artifacts differently in a new version; or **golangci-lint** has some new check(s) which fails on my not up to date repos). It means I need to install CLI Go tools globally (see [`GOBIN`](https://pkg.go.dev/cmd/go#hdr-Environment_variables)) and update every projects repo, I've been working with locally, to use tools from `GOBIN`. It's just nightmare to work with and every single CLI tool update it's [PITA](https://www.urbandictionary.com/define.php?term=pita).
3. Ideal solution is to define Go CLI tool per repository like it was done in Node.js, Java (Maven, Gradle), Scala (SBT) and so on. Unfortunately, Go doesn't have built-in solution for dev dependencies. But, we can introduce some conventions which help us to reach our goal.

## Initial thoughts

Basic high-level idea has been described [`tools.go` here][golang/wiki]. Also, I have collected some other `tools.go` variations in [References](#references) section.

Unfortunately, I don't like all of them except [uber]'s really impressive and huge `Makefile`. So, I took it and adjusted it to my own need.

## `tools.go` in action

### Expectations

- clone Go repo
- run test
- all required dependencies will be *downloaded* and *installed* automatically on repo level. Go CLI tools can't collide with any globally installed tools. Repo tools have higher priority then global tools while running them locally from repo's root folder.

### Sample project

## References

- **Articles**:
  - [*"Manage Go tools via Go modules"* by Marco Franssen, 2019](https://marcofranssen.nl/manage-go-tools-via-go-modules)
  - [*"Need to Version Go Tools for Your Project? That's a Bingo!"* by Bartek Płotka, 2020](https://www.bwplotka.dev/2020/bingo/)
  - [*"How to use go run to manage tool dependencies"* by Alex Edwards, 2022](https://www.alexedwards.net/blog/using-go-run-to-manage-tool-dependencies)
  - [*"Golang Tools as Dependencies"* by YC, 2022](https://www.tiredsg.dev/blog/golang-tools-as-dependencies/)
  - [*"Managing your Go tool versions with go.mod and a tools.go"* by Jamie Tanna, 2022](https://www.jvt.me/posts/2022/06/15/go-tools-dependency-management/)
  - [`go-modules-by-example` - Tools as dependencies](https://github.com/go-modules-by-example/index/blob/master/010_tools/README.md#tools-as-dependencies)
  - [`golang/wiki` - How can I track tool dependencies for a module?][golang/wiki]
  - [`go/build` - Build Constraints](https://pkg.go.dev/go/build#hdr-Build_Constraints)
- Repos:
  - ❤️ [uber/cadence/Makefile][uber] advance `tools.go` sample 
  - [`cmd/go`: track tool dependencies in go.mod](https://github.com/golang/go/issues/48429)

[golang/wiki]: https://github.com/golang/go/wiki/Modules#how-can-i-track-tool-dependencies-for-a-module "`golang/wiki` - How can I track tool dependencies for a module?"
[uber]: https://github.com/uber/cadence/blob/a253154e59d04048ea3aa6d77242d1a412b86688/Makefile "uber/cadence/Makefile"
